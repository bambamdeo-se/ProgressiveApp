(function(n){n.fn.imageUploaderCut=function(t){var i={fileInputId:t.fileInputId||"image-uploader-cut-input",pluginObject:this,apertureWidth:t.apertureWidth||48,apertureHeight:t.apertureHeight||48,proceedCallBack:t.proceedCallBack};this.append('<p><input type="file" name="files" value="" accept="image/*.jpg" id="'+i.fileInputId+'"/><\/p>');this.append('<div id="cropContainer"><\/div>');this.append('<p><input type="button" name="getCroppedImagesJson" value="Set Profile Picture"/><\/p>');n("#"+i.fileInputId).change(function(){n("#cropContainer").empty();r(this,i)});n("input[name=getCroppedImagesJson]").click(function(){var t=[];n(".cropAperture").each(function(i,r){var u=n(r),f=u.find("img"),e={Content:f.attr("src"),FileName:u.attr("data-filename"),ContentLenght:u.attr("data-filesize"),ImgWidth:f.width(),ImgHeight:f.height(),CropX:Math.abs(parseInt(f.css("left"))),CropY:Math.abs(parseInt(f.css("top"))),CropWidth:u.width(),CropHeight:u.height()};t.push(e)});i.proceedCallBack&&i.proceedCallBack(JSON.stringify(t))});var r=function(t,i){n(t.files).each(function(t,r){var e=new FileReader;e.onload=function(e){var h="preview"+t,c="aperture"+t,o,s,l;n("#cropContainer").append('<div class="cropAperture" id="'+c+'" data-filename="'+r.name+'" data-filesize="'+r.size+'"><img id="'+h+'" /> <\/div>');o=n("#"+h);s=n("#"+c);s.css({width:i.apertureWidth+"px",height:i.apertureHeight+"px","z-index":10,margin:"20px",overflow:"hidden"});o.css("z-index",9);o.attr("src",e.target.result);o.attr("zoomfactor",0);o.draggable({drag:function(n,t){var i,r;t.position.left>0&&(t.position.left=0);t.position.top>0&&(t.position.top=0);i=t.helper.height()-t.helper.parent().height();Math.abs(t.position.top)>i&&(t.position.top=i*-1);r=t.helper.width()-t.helper.parent().width();Math.abs(t.position.left)>r&&(t.position.left=r*-1)}});s.bind("mousewheel",function(n){var t=n.originalEvent.wheelDelta/120;u(n,t,o,s,1.1)});l=o.width()/o.height();s.attr("data-ratio",l);f(o,s)};e.readAsDataURL(r)})},e=function(n,t){var i=parseInt(n.css("top")),r=parseInt(n.css("left")),u=parseInt(n.css("height")),f=parseInt(n.css("Width")),e,o;u+=t;f+=t;e=n.parent().width();o=n.parent().height();u<o?(u=o,i=0):(i=u-Math.abs(i)<o?(u-o)*-1:(Math.abs(i)+t/2)*-1,i=i>0?0:i);f<e?(f=e,r=0):(r=f-Math.abs(r)<e?(f-e)*-1:(Math.abs(r)+t/2)*-1,r=r>0?0:r);n.css("left",r+"px");n.css("top",i+"px");n.css("width",f+"px");n.css("height",u+"px")},u=function(t,i,r,u,f){var o=f?Math.abs(f):this.options.zoomFactor,e=n(r),w=e.offset(),a=e.parent(),rt=parseInt(a.attr("index"),10),b=e.parent().offset(),k=t.pageX-b.left,d=t.pageY-b.top,c,l,s,h,tt=e.parent().height(),it=e.parent().width(),g=t.pageX-w.left,nt=t.pageY-w.top,v=parseFloat(e.attr("zoomfactor")),y,p;return i>0?u.hasClass("warning")||(c=g*o,l=nt*o,s=-1*(l-d),h=-1*(c-k),e.height(e.height()*o),e.width(e.width()*o),e.css("top",s+"px"),e.css("left",h+"px"),e.attr("zoomfactor",v+o)):v>0&&(c=g/o,l=nt/o,s=-1*(l-d),h=-1*(c-k),s>0&&(s=0),h>0&&(h=0),y=(-1*(e.height()/o-tt)).toFixed(2),p=(-1*(e.width()/o-it)).toFixed(2),s<y&&(s=y),h<p&&(h=p),e.height(e.height()/o),e.width(e.width()/o),e.height()<a.height()||e.width()<a.width()?e.attr("zoomfactor","0"):(e.css("top",s+"px"),e.css("left",h+"px"),e.attr("zoomfactor",v-o))),!1},f=function(n,t){var i=t.height(),r=t.width(),f=n.height(),e=n.width(),u,o=f/e,s=f/i,h=e/r;s<h?(n.height(i),n.width(i/o),u=(n.width()-r)/-2,n.css("left",u+"px"),n.css("top","0px")):(n.width(r),n.height(r*o),u=(n.height()-i)/-2,n.css("top",u+"px"),n.css("left","0px"))}}})(jQuery);